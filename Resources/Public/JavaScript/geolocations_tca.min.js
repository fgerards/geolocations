var Geocoder={marker:null,uid:0,mapNewWindow:false,geocoder:null,map:null,mapOptions:{zoom:17,scrollwheel:false,mapTypeId:google.maps.MapTypeId.ROADMAP},$mapCanvas:null,$messageField:null,initialize:function(a){this.uid=a;this.geocoder=new google.maps.Geocoder();this.$mapCanvas=TYPO3.jQuery("#map_canvas");this.$messageField=TYPO3.jQuery("#geocode-status-"+a);var b=this.$mapCanvas.closest(".form-section");b.append(this.$mapCanvas.detach())},showMap:function(){Geocoder.resetMessage();var b=Geocoder.getFieldValue("latitude").toFloat();var a=Geocoder.getFieldValue("longitude").toFloat();if(!isNaN(b)&&!isNaN(a)){if(this.mapNewWindow){Geocoder.linkToMap(b,a)}else{Geocoder.updateMap(b,a)}}else{Geocoder.showMessage(TYPO3.lang["geocoder.missingGeometry"],2)}},geocodeAddress:function(){Geocoder.resetMessage();var a=Geocoder.getAddress(this.uid);if(a!==""){this.geocoder.geocode({address:a},function(c,b){if(b===google.maps.GeocoderStatus.OK){var d=c[0].geometry.location;Geocoder.setFieldValue("latitude",d.lat());Geocoder.setFieldValue("longitude",d.lng());Geocoder.setFieldValue("place_id",c[0].place_id);Geocoder.updateMap(d.lat(),d.lng())}else{Geocoder.showMessage(TYPO3.lang["geocoder.error"]+b,1)}})}else{Geocoder.showMessage(TYPO3.lang["geocoder.missingAddress"],2)}},reverseGeocodeFromLatLng:function(c,a){var b={lat:parseFloat(c),lng:parseFloat(a)};this.geocoder.geocode({location:b},function(e,d){if(d===google.maps.GeocoderStatus.OK){if(e[1]){Geocoder.setFieldValue("place_id",e[0].place_id)}}else{Geocoder.showMessage(TYPO3.lang["geocoder.error"]+d,1)}})},linkToMap:function(d,b){var a="https://maps.google.de/maps?q="+d+","+b;var c=window.open(a,"_blank");c.focus()},updateMap:function(b,a){if(this.$mapCanvas.css("display")==="none"){this.$mapCanvas.show()}if(!this.map){this.map=new google.maps.Map(this.$mapCanvas[0],this.mapOptions)}if(this.marker){this.marker.setMap(null)}this.marker=new google.maps.Marker({map:this.map,position:{lat:b,lng:a},draggable:true});this.map.setCenter({lat:b,lng:a});google.maps.event.addListener(this.marker,"dragend",function(){var e=Geocoder.marker.getPosition().lat();var d=Geocoder.marker.getPosition().lng();var c=Geocoder.reverseGeocodeFromLatLng(e,d);Geocoder.setFieldValue("latitude",e);Geocoder.setFieldValue("longitude",d)})},getAddress:function(){var a=Geocoder.getFieldValue("zip");var b=Geocoder.getFieldValue("city");addressToGeocode=Geocoder.getFieldValue("address");if(a!==""||b!==""){addressToGeocode+=",";if(a!==""){addressToGeocode+=" "+a}if(b!==""){addressToGeocode+=" "+b}}return addressToGeocode},getFieldValue:function(c){var a="data[tx_geolocations_domain_model_location]["+this.uid+"]["+c+"]";var b=TYPO3.jQuery('[data-formengine-input-name="'+a+'"]');if(b.length){return b[0].value}else{return""}},setFieldValue:function(f,e){var a="data[tx_geolocations_domain_model_location]["+this.uid+"]["+f+"]";TBE_EDITOR.isChanged=1;var c=TYPO3.jQuery('[name="'+a+'"]');var d=TYPO3.jQuery('[data-formengine-input-name="'+a+'"]');if(!c.is(d)){d[0].value=e;d.triggerHandler("change")}c[0].value=e;var b=c.closest(".t3js-formengine-palette-field");b.addClass("has-change")},showMessage:function(c,b){switch(b){case 2:var a="label-info";break;case 1:var a="label-danger";break;default:var a="label-success"}this.$messageField.html(TYPO3.jQuery("<span />",{"class":"label "+a}).text(c)).show()},resetMessage:function(){this.$messageField.hide()}};String.prototype.toFloat=function(){return parseFloat(this)};